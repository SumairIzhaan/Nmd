<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NMD Orders - Voice Order Entry System</title>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script crossorigin
        src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        * {
            -webkit-tap-highlight-color: transparent;
        }

        body {
            margin: 0;
            padding: 0;
            overflow-x: hidden;
        }

        #root {
            min-height: 100vh;
        }
    </style>
</head>

<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const VoiceOrderEntry = () => {
            const [clients, setClients] = useState([
                'MIDC', 'Parbhakar', 'Abrar', 'Durg', 'Brahmapuri', 'Mr. K', 'Shri Ram',
                'Wayne', 'A1', 'Nikhil', 'Mohan', 'Ratna', 'Sawner', 'Khalsa', 'Khaparkheda',
                'Mishraji', 'Rasta', 'Chillar', 'Mamu', 'Devlapar', 'Suraj',
                'Katol gold', 'Anand Soda', 'Khamla', 'Kamthi', 'LG', 'Wardha', 'Manewada',
                'Ballarsha', 'Anuj dairy', 'Daryapur', 'Moseen pulgaon', 'Rc', 'Radhe wardha',
                'Patel saab', 'Nova'
            ]);
            const [newClientName, setNewClientName] = useState('');
            const [showAddClient, setShowAddClient] = useState(false);
            const [language, setLanguage] = useState('en-IN');

            const [orders, setOrders] = useState(() => {
                const saved = {};
                clients.forEach(client => saved[client] = 0);
                return saved;
            });
            const [currentIndex, setCurrentIndex] = useState(0);
            const [isListening, setIsListening] = useState(false);
            const [editMode, setEditMode] = useState(false);
            const [currentDate, setCurrentDate] = useState(new Date().toLocaleDateString('en-GB', {
                day: '2-digit',
                month: 'short',
                year: 'numeric'
            }));
            const [transcript, setTranscript] = useState('');
            const [showRetry, setShowRetry] = useState(false);
            const recognitionRef = useRef(null);
            const isListeningRef = useRef(false);
            const currentIndexRef = useRef(0);

            useEffect(() => {
                currentIndexRef.current = currentIndex;
            }, [currentIndex]);

            useEffect(() => {
                isListeningRef.current = isListening;
            }, [isListening]);

            useEffect(() => {
                if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                    const recog = new SpeechRecognition();
                    recog.continuous = false;
                    recog.interimResults = false;
                    recog.lang = language;

                    recog.onresult = (event) => {
                        const spokenText = event.results[0][0].transcript;
                        setTranscript(spokenText);
                        setShowRetry(false);

                        const matches = spokenText.match(/\d+/);
                        let number = 0;

                        if (matches) {
                            number = parseInt(matches[0]);
                        } else {
                            const wordToNum = {
                                'zero': 0, 'one': 1, 'two': 2, 'three': 3, 'four': 4, 'five': 5,
                                'six': 6, 'seven': 7, 'eight': 8, 'nine': 9, 'ten': 10,
                                'eleven': 11, 'twelve': 12, 'thirteen': 13, 'fourteen': 14, 'fifteen': 15,
                                'sixteen': 16, 'seventeen': 17, 'eighteen': 18, 'nineteen': 19, 'twenty': 20,
                                'thirty': 30, 'forty': 40, 'fifty': 50, 'sixty': 60, 'seventy': 70, 'eighty': 80, 'ninety': 90,
                                'hundred': 100, 'one hundred': 100, 'two hundred': 200, 'three hundred': 300,
                                'shunya': 0, 'ek': 1, 'do': 2, 'teen': 3, 'char': 4, 'paanch': 5, 'panch': 5,
                                'cheh': 6, 'saat': 7, 'aath': 8, 'nau': 9, 'das': 10,
                                'bees': 20, 'bis': 20, 'tees': 30, 'chalis': 40, 'pachas': 50,
                                'saath': 60, 'sattar': 70, 'assi': 80, 'nabbe': 90, 'sau': 100, 'so': 100,
                                'do sau': 200, 'teen sau': 300
                            };

                            const lowerText = spokenText.toLowerCase();
                            for (const [word, num] of Object.entries(wordToNum)) {
                                if (lowerText.includes(word)) {
                                    number = num;
                                    break;
                                }
                            }
                        }

                        const idx = currentIndexRef.current;
                        const client = clients[idx];

                        setOrders(prev => {
                            const newOrders = { ...prev, [client]: number };
                            return newOrders;
                        });
                    };

                    recog.onerror = (event) => {
                        if (event.error === 'no-speech') {
                            setTranscript('‚ö†Ô∏è No speech detected');
                            setShowRetry(true);
                        } else if (event.error === 'audio-capture') {
                            setTranscript('‚ö†Ô∏è Microphone not detected');
                            setShowRetry(true);
                        } else if (event.error !== 'aborted') {
                            setTranscript(`‚ö†Ô∏è Error: ${event.error}`);
                            setShowRetry(true);
                        }
                    };

                    recog.onend = () => {
                        if (isListeningRef.current && !showRetry) {
                            setShowRetry(true);
                        }
                    };

                    recognitionRef.current = recog;
                }
            }, [clients, language]);

            const startVoiceEntry = () => {
                if (recognitionRef.current) {
                    setIsListening(true);
                    setCurrentIndex(0);
                    setTranscript('');
                    setShowRetry(false);
                    startListeningForCurrent();
                } else {
                    alert('Speech recognition is not supported in your browser. Please use Chrome.');
                }
            };

            const startListeningForCurrent = () => {
                setTranscript('üé§ Listening...');
                setShowRetry(false);
                try {
                    if (recognitionRef.current) {
                        recognitionRef.current.start();
                    }
                } catch (e) {
                    setShowRetry(true);
                }
            };

            const retryCurrentClient = () => {
                startListeningForCurrent();
            };

            const skipToNext = () => {
                const idx = currentIndexRef.current;
                if (idx < clients.length - 1) {
                    setCurrentIndex(idx + 1);
                    setTranscript('');
                    setShowRetry(false);
                    setTimeout(() => startListeningForCurrent(), 300);
                } else {
                    setIsListening(false);
                    alert('All orders completed!');
                }
            };

            const confirmAndNext = () => {
                const idx = currentIndexRef.current;
                if (idx < clients.length - 1) {
                    setCurrentIndex(idx + 1);
                    setTranscript('');
                    setShowRetry(false);
                    setTimeout(() => startListeningForCurrent(), 300);
                } else {
                    setIsListening(false);
                    alert('All orders completed!');
                }
            };

            const stopVoiceEntry = () => {
                setIsListening(false);
                setShowRetry(false);
                if (recognitionRef.current) {
                    try {
                        recognitionRef.current.stop();
                    } catch (e) { }
                }
            };

            const totalPieces = Object.values(orders).reduce((sum, val) => sum + val, 0);
            const totalCrates = (totalPieces / 6).toFixed(2);

            const formatForWhatsApp = () => {
                const tomorrow = new Date();
                tomorrow.setDate(tomorrow.getDate() + 1);
                const tomorrowDate = tomorrow.toLocaleDateString('en-GB', {
                    day: '2-digit',
                    month: 'short',
                    year: 'numeric'
                });

                let text = `\tToday's Date: ${tomorrowDate}\t\t\n\t\t\t\n\tClient\tOrder\t\n`;

                clients.forEach(client => {
                    const order = orders[client];
                    const spacing = '\t'.repeat(Math.max(1, 3 - Math.floor(client.length / 8)));
                    text += `\t${client}.${spacing}=\t${order}\t\n`;
                });

                text += `\tTotal pieces       =\t${totalPieces}\t\n`;
                text += `\tTotal Crates  =\t${totalCrates}`;

                return text;
            };

            const copyToClipboard = () => {
                navigator.clipboard.writeText(formatForWhatsApp());
                alert('Order copied to clipboard! You can paste it in WhatsApp now.');
            };

            const resetOrders = () => {
                const reset = {};
                clients.forEach(client => reset[client] = 0);
                setOrders(reset);
                setCurrentIndex(0);
                setTranscript('');
                setShowRetry(false);
            };

            const addNewClient = () => {
                if (newClientName.trim() && !clients.includes(newClientName.trim())) {
                    setClients(prev => [...prev, newClientName.trim()]);
                    setOrders(prev => ({ ...prev, [newClientName.trim()]: 0 }));
                    setNewClientName('');
                    setShowAddClient(false);
                }
            };

            const removeClient = (clientName) => {
                if (confirm(`Remove ${clientName} from the list?`)) {
                    setClients(prev => prev.filter(c => c !== clientName));
                    setOrders(prev => {
                        const newOrders = { ...prev };
                        delete newOrders[clientName];
                        return newOrders;
                    });
                }
            };

            return (
                <div className="min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 p-4 pb-8">
                    <div className="max-w-4xl mx-auto bg-white/95 backdrop-blur-xl rounded-3xl shadow-2xl p-6 md:p-8 border border-purple-200">
                        <div className="text-center mb-6 md:mb-8">
                            <div className="inline-block p-3 bg-gradient-to-r from-purple-600 to-blue-600 rounded-2xl mb-3 shadow-lg">
                                <span className="text-3xl md:text-4xl">üì¶</span>
                            </div>
                            <h1 className="text-3xl md:text-4xl font-extrabold bg-gradient-to-r from-purple-600 to-blue-600 bg-clip-text text-transparent mb-2">
                                NMD Orders
                            </h1>
                            <p className="text-gray-500 text-xs md:text-sm">Voice-Powered Order Management</p>
                        </div>

                        <div className="mb-4 md:mb-6 p-4 md:p-5 bg-gradient-to-r from-amber-50 to-orange-50 border border-amber-200 rounded-2xl shadow-sm">
                            <label className="block text-xs md:text-sm font-bold mb-2 md:mb-3 text-gray-700 flex items-center gap-2">
                                <span>üåê</span> Voice Language
                            </label>
                            <select
                                value={language}
                                onChange={(e) => setLanguage(e.target.value)}
                                className="w-full p-3 border-2 border-amber-200 rounded-xl bg-white shadow-sm focus:border-amber-400 focus:ring-2 focus:ring-amber-200 transition-all text-sm md:text-base"
                                disabled={isListening}
                            >
                                <option value="en-IN">üáÆüá≥ English (India)</option>
                                <option value="hi-IN">üáÆüá≥ ‡§π‡§ø‡§Ç‡§¶‡•Ä (Hindi)</option>
                            </select>
                            <div className="mt-3 p-3 bg-white rounded-xl text-xs text-gray-600">
                                <div className="font-semibold mb-1">üí° Examples:</div>
                                <div>English: "twenty", "fifty", "hundred twenty five"</div>
                                <div>Hinglish: "bees", "pachas", "sau pachchis"</div>
                            </div>
                        </div>

                        <div className="mb-4 md:mb-6 flex gap-2 md:gap-3 justify-center flex-wrap">
                            {!isListening ? (
                                <button
                                    onClick={startVoiceEntry}
                                    className="flex items-center gap-2 bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 text-white px-6 md:px-8 py-3 md:py-4 rounded-xl font-bold transition-all shadow-lg hover:shadow-xl hover:scale-105 active:scale-95 text-sm md:text-base"
                                >
                                    <span className="text-lg md:text-xl">‚ñ∂Ô∏è</span> Start Voice Entry
                                </button>
                            ) : (
                                <button
                                    onClick={stopVoiceEntry}
                                    className="flex items-center gap-2 bg-gradient-to-r from-red-500 to-pink-600 hover:from-red-600 hover:to-pink-700 text-white px-6 md:px-8 py-3 md:py-4 rounded-xl font-bold transition-all shadow-lg hover:shadow-xl hover:scale-105 active:scale-95 text-sm md:text-base"
                                >
                                    <span className="text-lg md:text-xl">‚èπÔ∏è</span> Stop
                                </button>
                            )}

                            <button
                                onClick={() => setEditMode(!editMode)}
                                className="flex items-center gap-2 bg-gradient-to-r from-blue-500 to-indigo-600 hover:from-blue-600 hover:to-indigo-700 text-white px-5 md:px-6 py-3 md:py-4 rounded-xl font-bold transition-all shadow-lg hover:shadow-xl hover:scale-105 active:scale-95 text-sm md:text-base"
                            >
                                <span className="text-lg md:text-xl">‚úèÔ∏è</span> {editMode ? 'Done' : 'Edit'}
                            </button>

                            <button
                                onClick={copyToClipboard}
                                className="flex items-center gap-2 bg-gradient-to-r from-purple-500 to-violet-600 hover:from-purple-600 hover:to-violet-700 text-white px-5 md:px-6 py-3 md:py-4 rounded-xl font-bold transition-all shadow-lg hover:shadow-xl hover:scale-105 active:scale-95 text-sm md:text-base"
                            >
                                <span className="text-lg md:text-xl">üìã</span> Copy
                            </button>

                            <button
                                onClick={resetOrders}
                                className="flex items-center gap-2 bg-gradient-to-r from-gray-500 to-slate-600 hover:from-gray-600 hover:to-slate-700 text-white px-5 md:px-6 py-3 md:py-4 rounded-xl font-bold transition-all shadow-lg hover:shadow-xl hover:scale-105 active:scale-95 text-sm md:text-base"
                            >
                                <span className="text-lg md:text-xl">üîÑ</span> Reset
                            </button>

                            <button
                                onClick={() => setShowAddClient(!showAddClient)}
                                className="flex items-center gap-2 bg-gradient-to-r from-orange-500 to-amber-600 hover:from-orange-600 hover:to-amber-700 text-white px-5 md:px-6 py-3 md:py-4 rounded-xl font-bold transition-all shadow-lg hover:shadow-xl hover:scale-105 active:scale-95 text-sm md:text-base"
                            >
                                <span className="text-lg md:text-xl">{showAddClient ? '‚úï' : '‚ûï'}</span> {showAddClient ? 'Cancel' : 'Add'}
                            </button>
                        </div>

                        {showAddClient && (
                            <div className="mb-4 md:mb-6 p-4 md:p-5 bg-gradient-to-r from-orange-50 to-amber-50 border border-orange-200 rounded-2xl shadow-sm">
                                <label className="block text-xs md:text-sm font-bold mb-2 md:mb-3 text-gray-700 flex items-center gap-2">
                                    <span>üë§</span> New Client Name
                                </label>
                                <div className="flex gap-2 md:gap-3">
                                    <input
                                        type="text"
                                        value={newClientName}
                                        onChange={(e) => setNewClientName(e.target.value)}
                                        onKeyPress={(e) => e.key === 'Enter' && addNewClient()}
                                        placeholder="Enter client name"
                                        className="flex-1 p-3 border-2 border-orange-200 rounded-xl shadow-sm focus:border-orange-400 focus:ring-2 focus:ring-orange-200 transition-all text-sm md:text-base"
                                    />
                                    <button
                                        onClick={addNewClient}
                                        className="bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 text-white px-6 md:px-8 py-3 rounded-xl font-bold shadow-lg hover:shadow-xl hover:scale-105 active:scale-95 transition-all text-sm md:text-base"
                                    >
                                        Add
                                    </button>
                                </div>
                            </div>
                        )}

                        {isListening && (
                            <div className="mb-4 md:mb-6 p-4 md:p-6 bg-gradient-to-br from-green-50 via-emerald-50 to-teal-50 border-2 border-green-400 rounded-2xl shadow-xl">
                                <div className="flex items-center justify-center gap-2 md:gap-3 mb-3 md:mb-4">
                                    <span className="text-2xl md:text-3xl animate-pulse">üé§</span>
                                    <span className="text-xl md:text-2xl font-bold bg-gradient-to-r from-green-600 to-teal-600 bg-clip-text text-transparent">
                                        {clients[currentIndex]}
                                    </span>
                                </div>
                                <div className="text-center mb-3 md:mb-4">
                                    <div className="inline-block px-4 md:px-6 py-2 md:py-3 bg-white rounded-2xl shadow-md">
                                        <div className="text-xs md:text-sm text-gray-500 mb-1">Current Order</div>
                                        <div className="text-3xl md:text-4xl font-extrabold bg-gradient-to-r from-purple-600 to-blue-600 bg-clip-text text-transparent">
                                            {orders[clients[currentIndex]]}
                                        </div>
                                    </div>
                                </div>
                                {transcript && (
                                    <div className="text-xs md:text-sm bg-white/80 backdrop-blur p-2 md:p-3 rounded-xl mb-3 md:mb-4 text-center shadow-sm border border-gray-200">
                                        {transcript}
                                    </div>
                                )}

                                <div className="flex gap-2 justify-center flex-wrap">
                                    <button
                                        onClick={retryCurrentClient}
                                        className="bg-gradient-to-r from-yellow-500 to-amber-600 hover:from-yellow-600 hover:to-amber-700 text-white px-4 md:px-6 py-2 md:py-3 rounded-xl font-bold shadow-lg hover:shadow-xl hover:scale-105 active:scale-95 transition-all text-sm md:text-base"
                                    >
                                        üîÑ Retry
                                    </button>
                                    <button
                                        onClick={confirmAndNext}
                                        className="bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 text-white px-4 md:px-6 py-2 md:py-3 rounded-xl font-bold shadow-lg hover:shadow-xl hover:scale-105 active:scale-95 transition-all text-sm md:text-base"
                                    >
                                        ‚úì Next
                                    </button>
                                    <button
                                        onClick={skipToNext}
                                        className="bg-gradient-to-r from-blue-500 to-indigo-600 hover:from-blue-600 hover:to-indigo-700 text-white px-4 md:px-6 py-2 md:py-3 rounded-xl font-bold shadow-lg hover:shadow-xl hover:scale-105 active:scale-95 transition-all text-sm md:text-base"
                                    >
                                        ‚è≠Ô∏è Skip
                                    </button>
                                </div>
                            </div>
                        )}

                        <div className="mb-4 md:mb-6">
                            <label className="block text-xs md:text-sm font-bold mb-2 md:mb-3 text-gray-700 flex items-center gap-2">
                                <span>üìÖ</span> Date
                            </label>
                            <input
                                type="text"
                                value={currentDate}
                                onChange={(e) => setCurrentDate(e.target.value)}
                                className="w-full p-3 border-2 border-gray-200 rounded-xl shadow-sm focus:border-purple-400 focus:ring-2 focus:ring-purple-200 transition-all bg-white text-sm md:text-base"
                            />
                        </div>

                        <div className="grid grid-cols-2 md:grid-cols-2 lg:grid-cols-3 gap-3 md:gap-4 mb-4 md:mb-6 max-h-96 overflow-y-auto p-1 md:p-2">
                            {clients.map((client, idx) => (
                                <div
                                    key={client}
                                    className={`p-3 md:p-4 rounded-2xl border-2 transition-all relative shadow-md hover:shadow-lg ${idx === currentIndex && isListening
                                        ? 'border-green-400 bg-gradient-to-br from-green-50 to-emerald-50 scale-105'
                                        : 'border-gray-200 bg-gradient-to-br from-white to-gray-50 hover:border-purple-300'
                                        }`}
                                >
                                    <button
                                        onClick={() => removeClient(client)}
                                        className="absolute top-1 right-1 md:top-2 md:right-2 w-5 h-5 md:w-6 md:h-6 flex items-center justify-center bg-red-500 hover:bg-red-600 text-white rounded-full text-xs font-bold shadow-md hover:scale-110 transition-all"
                                        title="Remove client"
                                    >
                                        ‚úï
                                    </button>
                                    <div className="font-bold text-gray-700 mb-1 md:mb-2 pr-6 md:pr-8 text-xs md:text-base">{client}</div>
                                    {editMode ? (
                                        <input
                                            type="number"
                                            value={orders[client]}
                                            onChange={(e) => setOrders(prev => ({ ...prev, [client]: parseInt(e.target.value) || 0 }))}
                                            className="w-full p-2 border-2 border-purple-200 rounded-xl shadow-sm focus:border-purple-400 focus:ring-2 focus:ring-purple-200 transition-all text-sm md:text-base"
                                        />
                                    ) : (
                                        <div className="text-2xl md:text-3xl font-extrabold bg-gradient-to-r from-purple-600 to-blue-600 bg-clip-text text-transparent">
                                            {orders[client]}
                                        </div>
                                    )}
                                </div>
                            ))}
                        </div>

                        <div className="bg-gradient-to-br from-purple-50 via-blue-50 to-indigo-50 p-4 md:p-6 rounded-2xl shadow-xl border border-purple-200">
                            <div className="flex items-center justify-between mb-2 md:mb-3">
                                <div className="text-base md:text-lg font-bold text-gray-700">üìä Summary</div>
                            </div>
                            <div className="grid grid-cols-2 gap-3 md:gap-4">
                                <div className="bg-white p-3 md:p-4 rounded-xl shadow-md">
                                    <div className="text-xs md:text-sm text-gray-500 mb-1">Total Pieces</div>
                                    <div className="text-2xl md:text-3xl font-extrabold bg-gradient-to-r from-purple-600 to-blue-600 bg-clip-text text-transparent">
                                        {totalPieces}
                                    </div>
                                </div>
                                <div className="bg-white p-3 md:p-4 rounded-xl shadow-md">
                                    <div className="text-xs md:text-sm text-gray-500 mb-1">Total Crates</div>
                                    <div className="text-2xl md:text-3xl font-extrabold bg-gradient-to-r from-blue-600 to-indigo-600 bg-clip-text text-transparent">
                                        {totalCrates}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        ReactDOM.render(<VoiceOrderEntry />, document.getElementById('root'));
    </script>
</body>

</html>
