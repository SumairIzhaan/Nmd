<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NMD Orders - Voice Order Entry System</title>
    <!-- React & ReactDOM -->
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script crossorigin
        src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <!-- Babel -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0f172a;
            /* Slate 900 */
            color: #e2e8f0;
            /* Slate 200 */
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #1e293b;
        }

        ::-webkit-scrollbar-thumb {
            background: #475569;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #64748b;
        }

        /* Glassmorphism Utilities */
        .glass {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .glass-card {
            background: rgba(51, 65, 85, 0.4);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 255, 255, 0.05);
            transition: all 0.3s ease;
        }

        .glass-card:hover {
            background: rgba(51, 65, 85, 0.6);
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.4);
            border-color: rgba(139, 92, 246, 0.3);
            /* Violet-500 accent */
        }

        /* Animated Background */
        .bg-animated {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background:
                radial-gradient(circle at 15% 50%, rgba(76, 29, 149, 0.15) 0%, transparent 25%),
                radial-gradient(circle at 85% 30%, rgba(14, 165, 233, 0.15) 0%, transparent 25%);
        }

        /* Smooth inputs */
        input:focus,
        select:focus {
            outline: none;
            box-shadow: 0 0 0 2px rgba(139, 92, 246, 0.5);
        }
    </style>
</head>

<body>
    <div class="bg-animated"></div>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Custom Icons as SVG components for clean look
        const Icons = {
            Mic: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z" /></svg>,
            Stop: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 10a1 1 0 011-1h4a1 1 0 011 1v4a1 1 0 01-1 1H9a1 1 0 01-1-1v-4z" /></svg>,
            Edit: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" /></svg>,
            Copy: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3" /></svg>,
            Reset: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" /></svg>,
            Add: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 6v6m0 0v6m0-6h6m-6 0H6" /></svg>,
            Delete: () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" /></svg>,
            Check: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" /></svg>,
            Next: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 5l7 7-7 7M5 5l7 7-7 7" /></svg>,
        };

        const VoiceOrderEntry = () => {
            const [clients, setClients] = useState([
                'MIDC', 'Parbhakar', 'Abrar', 'Durg', 'Brahmapuri', 'Mr. K', 'Shri Ram',
                'Wayne', 'A1', 'Nikhil', 'Mohan', 'Ratna', 'Sawner', 'Khalsa', 'Khaparkheda',
                'Mishraji', 'Rasta', 'Chillar', 'Mamu', 'Devlapar', 'Suraj',
                'Katol gold', 'Anand Soda', 'Khamla', 'Kamthi', 'LG', 'Wardha', 'Manewada',
                'Ballarsha', 'Anuj dairy', 'Daryapur', 'Moseen pulgaon', 'Rc', 'Radhe wardha',
                'Patel saab', 'Nova'
            ]);

            // State initialization
            const [newClientName, setNewClientName] = useState('');
            const [showAddClient, setShowAddClient] = useState(false);
            const [language, setLanguage] = useState('en-IN');
            const [orders, setOrders] = useState(() => {
                const saved = {};
                clients.forEach(client => saved[client] = 0);
                return saved;
            });
            const [currentIndex, setCurrentIndex] = useState(0);
            const [isListening, setIsListening] = useState(false);
            const [editMode, setEditMode] = useState(false);
            const [currentDate, setCurrentDate] = useState(new Date().toLocaleDateString('en-GB', {
                day: '2-digit',
                month: 'short',
                year: 'numeric'
            }));
            const [transcript, setTranscript] = useState('');
            const [showRetry, setShowRetry] = useState(false);

            // Refs
            const recognitionRef = useRef(null);
            const isListeningRef = useRef(false);
            const currentIndexRef = useRef(0);

            // Sync refs
            useEffect(() => { currentIndexRef.current = currentIndex; }, [currentIndex]);
            useEffect(() => { isListeningRef.current = isListening; }, [isListening]);

            // Initialize Speech Recognition
            useEffect(() => {
                if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                    const recog = new SpeechRecognition();
                    recog.continuous = false;
                    recog.interimResults = false;
                    recog.lang = language;

                    recog.onresult = (event) => {
                        const spokenText = event.results[0][0].transcript;
                        setTranscript(spokenText);
                        setShowRetry(false);

                        // Number parsing logic
                        const matches = spokenText.match(/\d+/);
                        let number = 0;

                        if (matches) {
                            number = parseInt(matches[0]);
                        } else {
                            const wordToNum = {
                                'zero': 0, 'one': 1, 'two': 2, 'three': 3, 'four': 4, 'five': 5,
                                'six': 6, 'seven': 7, 'eight': 8, 'nine': 9, 'ten': 10,
                                'eleven': 11, 'twelve': 12, 'thirteen': 13, 'fourteen': 14, 'fifteen': 15,
                                'sixteen': 16, 'seventeen': 17, 'eighteen': 18, 'nineteen': 19, 'twenty': 20,
                                'thirty': 30, 'forty': 40, 'fifty': 50, 'sixty': 60, 'seventy': 70, 'eighty': 80, 'ninety': 90,
                                'hundred': 100, 'one hundred': 100, 'two hundred': 200, 'three hundred': 300,
                                'shunya': 0, 'ek': 1, 'do': 2, 'teen': 3, 'char': 4, 'paanch': 5, 'panch': 5,
                                'cheh': 6, 'saat': 7, 'aath': 8, 'nau': 9, 'das': 10,
                                'bees': 20, 'bis': 20, 'tees': 30, 'chalis': 40, 'pachas': 50,
                                'saath': 60, 'sattar': 70, 'assi': 80, 'nabbe': 90, 'sau': 100, 'so': 100,
                                'do sau': 200, 'teen sau': 300
                            };

                            const lowerText = spokenText.toLowerCase();
                            for (const [word, num] of Object.entries(wordToNum)) {
                                if (lowerText.includes(word)) {
                                    number = num;
                                    break;
                                }
                            }
                        }

                        const idx = currentIndexRef.current;
                        const client = clients[idx];

                        setOrders(prev => ({ ...prev, [client]: number }));
                    };

                    recog.onerror = (event) => {
                        if (event.error === 'no-speech') {
                            setTranscript('‚ö†Ô∏è No speech detected');
                            setShowRetry(true);
                        } else if (event.error === 'audio-capture') {
                            setTranscript('‚ö†Ô∏è Microphone not detected');
                            setShowRetry(true);
                        } else if (event.error !== 'aborted') {
                            setTranscript(`‚ö†Ô∏è Error: ${event.error}`);
                            setShowRetry(true);
                        }
                    };

                    recog.onend = () => {
                        if (isListeningRef.current && !showRetry) {
                            setShowRetry(true);
                        }
                    };

                    recognitionRef.current = recog;
                }
            }, [clients, language]);

            // Helper functions
            const startVoiceEntry = () => {
                if (recognitionRef.current) {
                    setIsListening(true);
                    setCurrentIndex(0);
                    setTranscript('');
                    setShowRetry(false);
                    startListeningForCurrent();
                } else {
                    alert('Speech recognition is not supported in your browser. Please use Chrome.');
                }
            };

            const startListeningForCurrent = () => {
                setTranscript('üé§ Listening...');
                setShowRetry(false);
                try {
                    if (recognitionRef.current) recognitionRef.current.start();
                } catch (e) {
                    setShowRetry(true);
                }
            };

            const retryCurrentClient = () => startListeningForCurrent();

            const nextWithDelay = () => {
                const idx = currentIndexRef.current;
                if (idx < clients.length - 1) {
                    setCurrentIndex(idx + 1);
                    setTranscript('');
                    setShowRetry(false);
                    setTimeout(() => startListeningForCurrent(), 300);
                } else {
                    setIsListening(false);
                    alert('All orders completed!');
                }
            }

            const skipToNext = () => nextWithDelay();
            const confirmAndNext = () => nextWithDelay();

            const stopVoiceEntry = () => {
                setIsListening(false);
                setShowRetry(false);
                if (recognitionRef.current) {
                    try { recognitionRef.current.stop(); } catch (e) { }
                }
            };

            const resetOrders = () => {
                const reset = {};
                clients.forEach(client => reset[client] = 0);
                setOrders(reset);
                setCurrentIndex(0);
                setTranscript('');
                setShowRetry(false);
            };

            const addNewClient = () => {
                if (newClientName.trim() && !clients.includes(newClientName.trim())) {
                    setClients(prev => [...prev, newClientName.trim()]);
                    setOrders(prev => ({ ...prev, [newClientName.trim()]: 0 }));
                    setNewClientName('');
                    setShowAddClient(false);
                }
            };

            const removeClient = (clientName) => {
                if (confirm(`Remove ${clientName} from the list?`)) {
                    setClients(prev => prev.filter(c => c !== clientName));
                    setOrders(prev => {
                        const newOrders = { ...prev };
                        delete newOrders[clientName];
                        return newOrders;
                    });
                }
            };

            // Calculations
            const totalPieces = Object.values(orders).reduce((sum, val) => sum + val, 0);
            const totalCrates = (totalPieces / 6).toFixed(2);

            // Updated Formatting Logic
            const formatForWhatsApp = () => {
                const tomorrow = new Date();
                tomorrow.setDate(tomorrow.getDate() + 1);
                const tomorrowDate = tomorrow.toLocaleDateString('en-GB', {
                    day: '2-digit', month: 'short', year: 'numeric'
                });

                let text = `\tToday's Date: ${tomorrowDate}\t\t\n\t\t\t\n\tClient\tOrder\t\n`;

                clients.forEach(client => {
                    const order = orders[client];
                    // Improved tab logic roughly based on length
                    let tabs = '\t\t';
                    if (client.length > 7) tabs = '\t';
                    if (client.length > 15) tabs = '';

                    text += `\t${client}.${tabs}=\t${order}\t\n`;
                });

                text += `\tTotal pieces       =\t${totalPieces}\t\n`;
                text += `\tTotal Crates  =\t${totalCrates}`;

                return text;
            };

            const copyToClipboard = () => {
                navigator.clipboard.writeText(formatForWhatsApp());
                // Use a toast instead of alert ideally, but alert is fine for now
                alert('Order copied to clipboard! Ready for WhatsApp.');
            };

            return (
                <div className="min-h-screen p-4 pb-12 flex flex-col items-center">

                    {/* Header */}
                    <div className="w-full max-w-6xl glass rounded-2xl p-6 mb-8 flex flex-col md:flex-row justify-between items-center gap-4">
                        <div className="flex items-center gap-4">
                            <div className="bg-violet-600/20 p-3 rounded-xl border border-violet-500/30">
                                <span className="text-3xl">üì¶</span>
                            </div>
                            <div>
                                <h1 className="text-2xl font-bold bg-gradient-to-r from-violet-400 to-fuchsia-400 bg-clip-text text-transparent">
                                    NMD Orders
                                </h1>
                                <p className="text-slate-400 text-sm">Voice Order Entry</p>
                            </div>
                        </div>

                        {/* Date Input */}
                        <div className="flex items-center gap-3 bg-slate-800/50 px-4 py-2 rounded-xl border border-slate-700">
                            <span className="text-slate-400">üìÖ</span>
                            <input
                                type="text"
                                value={currentDate}
                                onChange={(e) => setCurrentDate(e.target.value)}
                                className="bg-transparent border-none text-slate-200 focus:ring-0 w-32 text-center font-medium"
                            />
                        </div>
                    </div>

                    {/* Main Control Panel */}
                    <div className="w-full max-w-6xl grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">

                        {/* Summary Card */}
                        <div className="glass rounded-2xl p-6 md:col-span-1 flex flex-col justify-center gap-4">
                            <div className="bg-slate-800/50 p-4 rounded-xl border border-slate-700">
                                <div className="text-slate-400 text-xs uppercase tracking-wider mb-1">Total Pieces</div>
                                <div className="text-3xl font-bold text-violet-400">{totalPieces}</div>
                            </div>
                            <div className="bg-slate-800/50 p-4 rounded-xl border border-slate-700">
                                <div className="text-slate-400 text-xs uppercase tracking-wider mb-1">Total Crates</div>
                                <div className="text-3xl font-bold text-fuchsia-400">{totalCrates}</div>
                            </div>
                        </div>

                        {/* Actions Panel */}
                        <div className="glass rounded-2xl p-6 md:col-span-3 flex flex-col gap-4">
                            <div className="flex flex-wrap gap-3 justify-center md:justify-start items-center">
                                {/* Language Selector */}
                                <div className="relative group">
                                    <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                        <span className="text-lg">üåê</span>
                                    </div>
                                    <select
                                        value={language}
                                        onChange={(e) => setLanguage(e.target.value)}
                                        disabled={isListening}
                                        className="pl-10 pr-8 py-3 bg-slate-800 border border-slate-600 rounded-xl text-slate-200 text-sm focus:border-violet-500 appearance-none cursor-pointer hover:bg-slate-700 transition"
                                    >
                                        <option value="en-IN">English (India)</option>
                                        <option value="hi-IN">Hindi (India)</option>
                                    </select>
                                </div>

                                {/* Primary Actions */}
                                {!isListening ? (
                                    <button
                                        onClick={startVoiceEntry}
                                        className="flex items-center gap-2 bg-gradient-to-r from-emerald-600 to-teal-600 hover:from-emerald-500 hover:to-teal-500 text-white px-6 py-3 rounded-xl font-semibold shadow-lg shadow-emerald-500/20 active:scale-95 transition-all"
                                    >
                                        <Icons.Mic /> Start Entry
                                    </button>
                                ) : (
                                    <button
                                        onClick={stopVoiceEntry}
                                        className="flex items-center gap-2 bg-gradient-to-r from-rose-600 to-pink-600 hover:from-rose-500 hover:to-pink-500 text-white px-6 py-3 rounded-xl font-semibold shadow-lg shadow-rose-500/20 active:scale-95 transition-all"
                                    >
                                        <Icons.Stop /> Stop
                                    </button>
                                )}

                                <div className="h-8 w-px bg-slate-700 mx-2 hidden md:block"></div>

                                <button onClick={() => setEditMode(!editMode)} className={`flex items-center gap-2 px-5 py-3 rounded-xl font-medium transition-all ${editMode ? 'bg-violet-600 text-white' : 'bg-slate-700 text-slate-300 hover:bg-slate-600'}`}>
                                    <Icons.Edit /> {editMode ? 'Done' : 'Edit'}
                                </button>

                                <button onClick={copyToClipboard} className="flex items-center gap-2 bg-slate-700 hover:bg-slate-600 text-slate-300 px-5 py-3 rounded-xl font-medium transition-all">
                                    <Icons.Copy /> Copy
                                </button>

                                <button onClick={resetOrders} className="flex items-center gap-2 bg-slate-700 hover:bg-slate-600 text-slate-300 px-5 py-3 rounded-xl font-medium transition-all">
                                    <Icons.Reset /> Reset
                                </button>

                                <button onClick={() => setShowAddClient(!showAddClient)} className={`flex items-center gap-2 px-5 py-3 rounded-xl font-medium transition-all ${showAddClient ? 'bg-orange-600 text-white' : 'bg-slate-700 text-slate-300 hover:bg-slate-600'}`}>
                                    <Icons.Add /> {showAddClient ? 'Cancel' : 'Add Client'}
                                </button>
                            </div>

                            {/* Add Client Form */}
                            {showAddClient && (
                                <div className="mt-2 flex gap-3 p-4 bg-slate-800/50 rounded-xl border border-slate-700 animate-fade-in">
                                    <input
                                        type="text"
                                        value={newClientName}
                                        onChange={(e) => setNewClientName(e.target.value)}
                                        onKeyPress={(e) => e.key === 'Enter' && addNewClient()}
                                        placeholder="Enter new client name..."
                                        className="flex-1 bg-slate-900 border border-slate-600 rounded-lg px-4 py-2 text-slate-200 focus:border-orange-500"
                                    />
                                    <button onClick={addNewClient} className="bg-orange-600 hover:bg-orange-500 text-white px-6 py-2 rounded-lg font-medium transition-colors">
                                        Save
                                    </button>
                                </div>
                            )}

                            {/* Active Voice Interface */}
                            {isListening && (
                                <div className="mt-4 p-6 bg-emerald-900/20 border border-emerald-500/30 rounded-xl flex flex-col items-center animate-pulse-slow">
                                    <div className="text-emerald-400 font-medium mb-1">Currently Listening for</div>
                                    <div className="text-3xl font-bold text-white mb-4 tracking-wide">{clients[currentIndex]}</div>

                                    <div className="flex gap-4 w-full justify-center">
                                        <div className="bg-slate-900/80 px-8 py-4 rounded-xl border border-emerald-500/20 min-w-[120px] text-center">
                                            <div className="text-slate-400 text-xs uppercase mb-1">Current Value</div>
                                            <div className="text-4xl font-bold text-emerald-400">{orders[clients[currentIndex]]}</div>
                                        </div>
                                    </div>

                                    <div className="h-8 flex items-center justify-center my-2 text-slate-300 italic text-sm">
                                        {transcript || "Listening..."}
                                    </div>

                                    <div className="flex gap-3 mt-2">
                                        <button onClick={retryCurrentClient} className="px-4 py-2 bg-slate-700 hover:bg-slate-600 rounded-lg text-sm text-white font-medium">Retry</button>
                                        <button onClick={confirmAndNext} className="px-6 py-2 bg-emerald-600 hover:bg-emerald-500 rounded-lg text-sm text-white font-medium flex items-center gap-2"><Icons.Check /> Next</button>
                                        <button onClick={skipToNext} className="px-4 py-2 bg-slate-700 hover:bg-slate-600 rounded-lg text-sm text-white font-medium flex items-center gap-2">Skip <Icons.Next /></button>
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>

                    {/* Client Grid */}
                    <div className="w-full max-w-6xl grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 pb-20">
                        {clients.map((client, idx) => (
                            <div
                                key={client}
                                className={`glass-card rounded-xl p-4 relative group ${idx === currentIndex && isListening
                                        ? 'border-emerald-500 bg-emerald-900/10 ring-2 ring-emerald-500/20 transform scale-105 z-10'
                                        : ''
                                    }`}
                            >
                                <div className="flex justify-between items-start mb-2">
                                    <div className="font-semibold text-slate-200 truncate pr-6">{client}</div>
                                    <button
                                        onClick={(e) => { e.stopPropagation(); removeClient(client); }}
                                        className="opacity-0 group-hover:opacity-100 absolute top-2 right-2 p-1 text-rose-400 hover:bg-rose-500/20 rounded-full transition-all"
                                        title="Remove client"
                                    >
                                        <Icons.Delete />
                                    </button>
                                </div>

                                {editMode ? (
                                    <input
                                        type="number"
                                        value={orders[client]}
                                        onChange={(e) => setOrders(prev => ({ ...prev, [client]: parseInt(e.target.value) || 0 }))}
                                        className="w-full bg-slate-900/50 border border-slate-600 rounded-lg px-3 py-2 text-center text-lg font-bold text-violet-300 focus:border-violet-500"
                                    />
                                ) : (
                                    <div className="text-3xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-violet-300 to-fuchsia-300 text-center py-1">
                                        {orders[client]}
                                    </div>
                                )}
                            </div>
                        ))}
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<VoiceOrderEntry />);
    </script>
</body>

</html>
